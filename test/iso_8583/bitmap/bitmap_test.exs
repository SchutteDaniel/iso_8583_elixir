defmodule BitmapTest do
  use ExUnit.Case
  alias Iso8583.Bitmap
  doctest Bitmap

  test "should create the right bitmap case 1" do
    message = %{
      "0": "0100",
      "11": "123456",
      "12": "105843",
      "123": "91010151134C101",
      "127":
        "000000800000000001927E1E5F7C0000000000000000200000000000000014A00000000310107C0000C2FF004934683D9B5D1447800280000000000000000410342031F024103021406010A03A42002008CE0D0C84042100000488004041709018000003276039079EDA",
      "13": "0901",
      "14": "1905",
      "18": "4111",
      "2": "4180875104555684",
      "22": "051",
      "23": "000",
      "25": "00",
      "26": "12",
      "3": "000000",
      "32": "423935",
      "33": "111111111",
      "35": "4180875104555684D190522611950628",
      "37": "724410123456",
      "4": "000000002000",
      "41": "12345678",
      "42": "MOBITILL0000001",
      "43": "Mobitll Merchant 1 0000000 NAIROBI KE KE",
      "49": "404",
      "52": "481C9038075937B1",
      "56": "1510",
      "7": "0901105843"
    }

    assert Bitmap.fields_0_127_binary(message) == "F23C46C1A8E091000000000000000022"
  end

  test "should create the right bitmap case 2" do
    message = %{
      "0": "1200",
      "2": "4761739001010119",
      "3": "000000",
      "4": "000000005000",
      "6": "000000005000",
      "22": "051",
      "23": "001",
      "25": "00",
      "26": "12",
      "32": "423935",
      "33": "111111111",
      "35": "4761739001010119D22122011758928889",
      "41": "12345678"
    }

    assert Bitmap.fields_0_127_binary(message) == "F40006C1A08000000000000000000000"
  end

  test "should create the right bitmap fields 127.0-64" do
    message = %{
      "127":
        "000000800000000001927E1E5F7C0000000000000000200000000000000014A00000000310107C0000C2FF004934683D9B5D1447800280000000000000000410342031F024103021406010A03A42002008CE0D0C84042100000488004041709018000003276039079EDA",
      "127.1": "0000008000000000",
      "127.25":
        "7E1E5F7C0000000000000000200000000000000014A00000000310107C0000C2FF004934683D9B5D1447800280000000000000000410342031F024103021406010A03A42002008CE0D0C84042100000488004041709018000003276039079EDA",
      "127.25.1": "7E1E5F7C00000000",
      "127.25.2": "000000002000",
      "127.25.3": "000000000000",
      "127.25.4": "A0000000031010",
      "127.25.5": "7C00",
      "127.25.6": "00C2",
      "127.25.7": "FF00",
      "127.25.12": "4934683D9B5D1447",
      "127.25.13": "80",
      "127.25.14": "0000000000000000410342031F02",
      "127.25.15": "410302",
      "127.25.18": "06010A03A42002",
      "127.25.20": "008C",
      "127.25.21": "E0D0C8",
      "127.25.22": "404",
      "127.25.23": "21",
      "127.25.24": "0000048800",
      "127.25.26": "404",
      "127.25.27": "170901",
      "127.25.28": "00000327",
      "127.25.29": "60",
      "127.25.30": "39079EDA"
    }

    assert Bitmap.fields_127_0_63_binary(message) == "8000008000000000"
  end

  test "should create the right bitmap fields 127.25.0-64" do
    message = %{
      "127":
        "000000800000000001927E1E5F7C0000000000000000200000000000000014A00000000310107C0000C2FF004934683D9B5D1447800280000000000000000410342031F024103021406010A03A42002008CE0D0C84042100000488004041709018000003276039079EDA",
      "127.1": "0000008000000000",
      "127.25":
        "7E1E5F7C0000000000000000200000000000000014A00000000310107C0000C2FF004934683D9B5D1447800280000000000000000410342031F024103021406010A03A42002008CE0D0C84042100000488004041709018000003276039079EDA",
      "127.25.1": "7E1E5F7C00000000",
      "127.25.2": "000000002000",
      "127.25.3": "000000000000",
      "127.25.4": "A0000000031010",
      "127.25.5": "7C00",
      "127.25.6": "00C2",
      "127.25.7": "FF00",
      "127.25.12": "4934683D9B5D1447",
      "127.25.13": "80",
      "127.25.14": "0000000000000000410342031F02",
      "127.25.15": "410302",
      "127.25.18": "06010A03A42002",
      "127.25.20": "008C",
      "127.25.21": "E0D0C8",
      "127.25.22": "404",
      "127.25.23": "21",
      "127.25.24": "0000048800",
      "127.25.26": "404",
      "127.25.27": "170901",
      "127.25.28": "00000327",
      "127.25.29": "60",
      "127.25.30": "39079EDA"
    }

    assert Bitmap.fields_127_25_0_25_binary(message) == "FE1E5F7C00000000"
  end
end
